<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§  Memory AI Assistant - æ™ºèƒ½è®°å¿†åŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .main-container {
            max-width: 1400px;
            width: 100%;
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            height: 90vh;
        }

        /* å·¦ä¾§ä¿¡æ¯é¢æ¿ */
        .info-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .logo {
            font-size: 64px;
            text-align: center;
            margin-bottom: 10px;
        }

        .info-panel h1 {
            font-size: 24px;
            color: #2d3748;
            text-align: center;
            margin-bottom: 8px;
        }

        .tagline {
            text-align: center;
            color: #718096;
            font-size: 14px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin: 20px 0 12px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .features {
            list-style: none;
        }

        .features li {
            padding: 12px 0;
            color: #4a5568;
            font-size: 14px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .features li::before {
            content: "âœ“";
            display: inline-block;
            width: 20px;
            height: 20px;
            background: #48bb78;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            font-size: 12px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .demo-examples {
            background: #edf2f7;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .demo-examples h4 {
            font-size: 13px;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .demo-examples p {
            font-size: 12px;
            color: #4a5568;
            margin: 6px 0;
            padding-left: 10px;
            border-left: 3px solid #667eea;
        }

        .tech-stack {
            margin-top: auto;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
            font-size: 12px;
            color: #718096;
        }

        .tech-stack strong {
            display: block;
            color: #2d3748;
            margin-bottom: 8px;
        }

        /* å³ä¾§èŠå¤©å®¹å™¨ */
        .chat-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chat-header .icon {
            font-size: 32px;
        }

        .chat-header-text h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .chat-header-text .subtitle {
            font-size: 13px;
            opacity: 0.9;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            background: #f7fafc;
        }

        .message {
            margin-bottom: 16px;
            display: flex;
            gap: 12px;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .message.assistant .message-avatar {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 16px;
            line-height: 1.6;
            font-size: 14px;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.assistant .message-content {
            background: white;
            color: #2d3748;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .memory-badge {
            display: inline-block;
            background: #fef5e7;
            color: #d68910;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin-left: 6px;
            font-weight: 600;
        }

        .typing-indicator {
            display: none;
        }

        .typing-indicator.active {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #cbd5e0;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-8px); opacity: 1; }
        }

        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #718096;
        }

        .welcome-message h3 {
            color: #2d3748;
            margin-bottom: 12px;
            font-size: 20px;
        }

        .welcome-message p {
            margin-bottom: 20px;
        }

        .welcome-examples {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 25px;
        }

        .example-chip {
            padding: 10px 18px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            color: #4a5568;
        }

        .example-chip:hover {
            border-color: #667eea;
            background: #f7fafc;
            transform: translateY(-2px);
        }

        .input-area {
            padding: 20px 25px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 12px;
        }

        .input-area input {
            flex: 1;
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s;
        }

        .input-area input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-area button {
            padding: 14px 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .input-area button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .input-area button:active {
            transform: translateY(0);
        }

        .input-area button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .api-config-notice {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 15px;
            margin: 20px;
            text-align: center;
        }

        .api-config-notice h4 {
            color: #856404;
            margin-bottom: 8px;
        }

        .api-config-notice p {
            color: #856404;
            font-size: 13px;
            margin: 4px 0;
        }

        .api-config-notice code {
            background: #ffe8a1;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }

        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
                height: auto;
            }

            .info-panel {
                max-height: none;
            }

            .chat-container {
                height: 600px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- å·¦ä¾§ä¿¡æ¯é¢æ¿ -->
        <div class="info-panel">
            <div class="logo">ğŸ§ </div>
            <h1>Memory AI Assistant</h1>
            <p class="tagline">æ™ºèƒ½è®°å¿†åŠ©æ‰‹ - æ°¸è¿œè®°ä½ä½ </p>

            <div class="section-title">âœ¨ æ ¸å¿ƒåŠŸèƒ½</div>
            <ul class="features">
                <li>è‡ªåŠ¨è¯†åˆ«å¹¶è®°ä½é‡è¦ä¿¡æ¯</li>
                <li>æ™ºèƒ½åŒºåˆ†é•¿æœŸè®°å¿†å’ŒçŸ­æœŸå¯¹è¯</li>
                <li>ä¸ªæ€§åŒ–å›å¤ï¼Œå¼•ç”¨å†å²è®°å¿†</li>
                <li>è‡ªåŠ¨åˆ†ç±»ï¼šåå¥½ã€äº‹å®ã€ç›®æ ‡ã€ä¹ æƒ¯</li>
                <li>è·¨ä¼šè¯è®°å¿†ä¿æŒ</li>
                <li>åŸºäºä¸Šä¸‹æ–‡çš„æ™ºèƒ½æ£€ç´¢</li>
            </ul>

            <div class="section-title">ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹</div>
            <div class="demo-examples">
                <h4>ç¬¬ä¸€æ­¥ï¼šå‘Šè¯‰æˆ‘å…³äºä½ çš„ä¿¡æ¯</h4>
                <p>ğŸ’¬ "æˆ‘å«å¼ ä¸‰ï¼Œæˆ‘æ˜¯ä¸€åè½¯ä»¶å·¥ç¨‹å¸ˆ"</p>
                <p>â¤ï¸ "æˆ‘å–œæ¬¢å–å’–å•¡å’Œé˜…è¯»ç§‘å¹»å°è¯´"</p>
                <p>ğŸ¯ "æˆ‘çš„ç›®æ ‡æ˜¯ä»Šå¹´å­¦ä¼šPython"</p>
                
                <h4 style="margin-top: 15px;">ç¬¬äºŒæ­¥ï¼šæµ‹è¯•è®°å¿†åŠŸèƒ½</h4>
                <p>ğŸ” "ä½ çŸ¥é“æˆ‘çš„èŒä¸šå—ï¼Ÿ"</p>
                <p>ğŸ” "æ¨èä¸€äº›é€‚åˆæˆ‘çš„ä¹¦ç±"</p>
                <p>ğŸ” "æˆ‘å–œæ¬¢ä»€ä¹ˆé¥®æ–™ï¼Ÿ"</p>
            </div>

            <div class="section-title">ğŸ¯ é¡¹ç›®äº®ç‚¹</div>
            <ul class="features">
                <li>åŸºäºLLMçš„æ™ºèƒ½åˆ†ç±»åˆ¤æ–­</li>
                <li>æ¡ä»¶è·¯ç”±å®ç°é•¿çŸ­æœŸè®°å¿†åˆ†ç¦»</li>
                <li>å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢ç›¸å…³è®°å¿†</li>
                <li>ä¸ªæ€§åŒ–å¯¹è¯ä½“éªŒ</li>
            </ul>

            <div class="tech-stack">
                <strong>ğŸ”§ æŠ€æœ¯æ ˆ</strong>
                å¹³å°: Airia AI Platform<br>
                æ¨¡å‹: Claude 3.5 Sonnet (via OpenRouter)<br>
                æ¶æ„: Memory Classification + Conditional Routing<br>
                å­˜å‚¨: Airia Memory System
            </div>
        </div>

        <!-- å³ä¾§èŠå¤©å®¹å™¨ -->
        <div class="chat-container">
            <div class="chat-header">
                <div class="icon">ğŸ’¬</div>
                <div class="chat-header-text">
                    <h2>å¼€å§‹å¯¹è¯</h2>
                    <div class="subtitle">ä½“éªŒæœ‰è®°å¿†çš„AIåŠ©æ‰‹</div>
                </div>
            </div>

            <!-- APIé…ç½®æç¤º -->
            <div class="api-config-notice" id="apiNotice">
                <h4>âš™ï¸ é…ç½®è¯´æ˜</h4>
                <p>æ­¤é¡µé¢ä¸ºæ¼”ç¤ºç•Œé¢ï¼Œéœ€è¦é…ç½®Airia APIæ‰èƒ½ä½¿ç”¨ã€‚</p>
                <p>è¯·åœ¨ä»£ç ä¸­ä¿®æ”¹ <code>CONFIG.API_ENDPOINT</code> å’Œ <code>CONFIG.API_KEY</code></p>
                <p style="margin-top: 8px; font-size: 12px;">æˆ–è€…ä½¿ç”¨ä¸‹æ–¹çš„æ¨¡æ‹Ÿæ¼”ç¤ºæ¨¡å¼ä½“éªŒåŠŸèƒ½</p>
            </div>

            <div class="messages" id="messages">
                <div class="welcome-message">
                    <h3>ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯Memory AI</h3>
                    <p>æˆ‘å¯ä»¥è®°ä½ä½ å‘Šè¯‰æˆ‘çš„ä¿¡æ¯ï¼Œå¹¶åœ¨ä¹‹åçš„å¯¹è¯ä¸­å¼•ç”¨å®ƒä»¬ã€‚</p>
                    <p style="font-size: 13px; color: #a0aec0;">è¯•è¯•ç‚¹å‡»ä¸‹é¢çš„ç¤ºä¾‹å¼€å§‹å¯¹è¯ â¬‡ï¸</p>
                    
                    <div class="welcome-examples">
                        <div class="example-chip" onclick="sendExample('æˆ‘å«æåï¼Œæˆ‘æ˜¯ä¸€åæ•™å¸ˆ')">
                            ğŸ‘¤ ä»‹ç»è‡ªå·±
                        </div>
                        <div class="example-chip" onclick="sendExample('æˆ‘å–œæ¬¢å–å’–å•¡å’Œçœ‹ç§‘å¹»ç”µå½±')">
                            â¤ï¸ åˆ†äº«çˆ±å¥½
                        </div>
                        <div class="example-chip" onclick="sendExample('æˆ‘çš„ç›®æ ‡æ˜¯å­¦ä¼šPythonç¼–ç¨‹')">
                            ğŸ¯ è®¾å®šç›®æ ‡
                        </div>
                        <div class="example-chip" onclick="sendExample('ä½ çŸ¥é“æˆ‘æ˜¯åšä»€ä¹ˆå·¥ä½œçš„å—ï¼Ÿ')">
                            ğŸ” æµ‹è¯•è®°å¿†
                        </div>
                    </div>
                </div>
            </div>

            <div class="input-area">
                <input 
                    type="text" 
                    id="userInput" 
                    placeholder="è¾“å…¥æ¶ˆæ¯... (æŒ‰Enterå‘é€)" 
                    onkeypress="handleKeyPress(event)"
                >
                <button onclick="sendMessage()" id="sendButton">å‘é€</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== é…ç½®åŒº ====================
        const CONFIG = {
            // TODO: æ›¿æ¢æˆä½ çš„Airia APIä¿¡æ¯
            API_ENDPOINT: 'https://api.airia.ai/v2/PipelineExecution/6f533036-6546-4f0d-9e3c-a0dc78c03521',  // ä¾‹å¦‚: 'https://api.airia.com/v1/agents/xxx/execute'
            API_KEY: 'ak-OTQ5MTk3MzA0fDE3NjI2Mjg1MTg4Mjl8dGktUTJGeWJtVm5hV1VnVFdWc2JHOXVJRlZ1YVhabGNuTnBkSGt0VDNCbGJpQlNaV2RwYzNSeVlYUnBiMjR0VUhKdlptVnpjMmx2Ym1Gc1h6TTVObUZrTlRFNExXUm1ZbUV0TkRBeE1DMDVaREF6TFdZMVpXWTFNR0kwTURaaU1nPT18MXwzNDg4MzIzODIz',       // ä½ çš„Airia API Key
            USE_DEMO_MODE: true  // å¦‚æœæ²¡æœ‰APIï¼Œä½¿ç”¨æ¼”ç¤ºæ¨¡å¼
        };

        // ==================== æ ¸å¿ƒåŠŸèƒ½ ====================
        const messagesDiv = document.getElementById('messages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');

        // æ¨¡æ‹Ÿè®°å¿†å­˜å‚¨ï¼ˆæ¼”ç¤ºæ¨¡å¼ç”¨ï¼‰
        let memoryBank = [];

        // æ·»åŠ æ¶ˆæ¯
        function addMessage(role, content, hasMemory = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = content + (hasMemory ? '<span class="memory-badge">å·²è®°å¿†</span>' : '');
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            const welcome = messagesDiv.querySelector('.welcome-message');
            if (welcome) welcome.remove();
        }

        // æ˜¾ç¤ºè¾“å…¥ä¸­...
        function showTyping() {
            const typing = document.createElement('div');
            typing.className = 'message assistant';
            typing.id = 'typing-indicator';
            typing.innerHTML = `
                <div class="message-avatar">ğŸ¤–</div>
                <div class="typing-indicator active">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            messagesDiv.appendChild(typing);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function hideTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        // æ¼”ç¤ºæ¨¡å¼ - æ¨¡æ‹ŸAIå›å¤
        function getDemoResponse(message) {
            const lowerMsg = message.toLowerCase();
            
            // æ£€æµ‹éœ€è¦è®°å¿†çš„ä¿¡æ¯
            const memoryPatterns = [
                { pattern: /æˆ‘å«(.+?)([ï¼Œã€‚]|$)/, category: 'fact', extract: (m) => `ç”¨æˆ·å«${m[1]}` },
                { pattern: /æˆ‘æ˜¯(.+?)([ï¼Œã€‚]|$)/, category: 'fact', extract: (m) => `ç”¨æˆ·èŒä¸šæ˜¯${m[1]}` },
                { pattern: /æˆ‘å–œæ¬¢(.+?)([ï¼Œã€‚]|$)/, category: 'preference', extract: (m) => `ç”¨æˆ·å–œæ¬¢${m[1]}` },
                { pattern: /æˆ‘çš„ç›®æ ‡æ˜¯(.+?)([ï¼Œã€‚]|$)/, category: 'goal', extract: (m) => `ç”¨æˆ·ç›®æ ‡ï¼š${m[1]}` },
            ];

            let shouldStore = false;
            let memoryText = '';

            for (const { pattern, category, extract } of memoryPatterns) {
                const match = message.match(pattern);
                if (match) {
                    shouldStore = true;
                    memoryText = extract(match);
                    memoryBank.push({ text: memoryText, category, original: message });
                    break;
                }
            }

            // ç”Ÿæˆå›å¤
            if (shouldStore) {
                return {
                    reply: `å¥½çš„ï¼Œæˆ‘è®°ä½äº†ï¼${memoryText}ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ`,
                    hasMemory: true
                };
            }

            // æ£€ç´¢ç›¸å…³è®°å¿†
            const relevantMemories = memoryBank.filter(mem => {
                const memWords = mem.text.toLowerCase().split(/\s+/);
                const inputWords = lowerMsg.split(/\s+/);
                return memWords.some(w => inputWords.includes(w));
            });

            // æ ¹æ®é—®é¢˜ç±»å‹ç”Ÿæˆå›å¤
            if (lowerMsg.includes('èŒä¸š') || lowerMsg.includes('å·¥ä½œ') || lowerMsg.includes('åšä»€ä¹ˆ')) {
                const jobMem = memoryBank.find(m => m.text.includes('èŒä¸š'));
                if (jobMem) {
                    return { reply: `æ ¹æ®æˆ‘çš„è®°å¿†ï¼Œ${jobMem.text}ã€‚`, hasMemory: false };
                }
                return { reply: 'æŠ±æ­‰ï¼Œä½ è¿˜æ²¡æœ‰å‘Šè¯‰æˆ‘ä½ çš„èŒä¸šä¿¡æ¯å‘¢ã€‚', hasMemory: false };
            }

            if (lowerMsg.includes('åå­—') || lowerMsg.includes('å«ä»€ä¹ˆ')) {
                const nameMem = memoryBank.find(m => m.text.includes('å«'));
                if (nameMem) {
                    return { reply: `æˆ‘è®°å¾—${nameMem.text}ï¼`, hasMemory: false };
                }
                return { reply: 'ä½ è¿˜æ²¡æœ‰å‘Šè¯‰æˆ‘ä½ çš„åå­—å‘¢ã€‚', hasMemory: false };
            }

            if (lowerMsg.includes('å–œæ¬¢') || lowerMsg.includes('çˆ±å¥½')) {
                const prefMem = memoryBank.find(m => m.category === 'preference');
                if (prefMem) {
                    return { reply: `æˆ‘è®°å¾—${prefMem.text}ï¼`, hasMemory: false };
                }
            }

            if (lowerMsg.includes('æ¨è') || lowerMsg.includes('å»ºè®®')) {
                if (relevantMemories.length > 0) {
                    const context = relevantMemories.map(m => m.text).join('ï¼Œ');
                    return { 
                        reply: `åŸºäºæˆ‘å¯¹ä½ çš„äº†è§£ï¼ˆ${context}ï¼‰ï¼Œæˆ‘å»ºè®®ä½ å¯ä»¥å°è¯•ä¸€äº›ç›¸å…³çš„å†…å®¹ã€‚æ¯”å¦‚å¦‚æœä½ æ˜¯ç¨‹åºå‘˜ï¼Œå¯ä»¥çœ‹çœ‹ã€Šä»£ç å¤§å…¨ã€‹ï¼›å¦‚æœä½ å–œæ¬¢ç§‘å¹»ï¼Œæ¨èã€Šä¸‰ä½“ã€‹ç³»åˆ—ã€‚`, 
                        hasMemory: false 
                    };
                }
            }

            if (lowerMsg.includes('ç›®æ ‡')) {
                const goalMem = memoryBank.find(m => m.category === 'goal');
                if (goalMem) {
                    return { reply: `æˆ‘è®°å¾—${goalMem.text}ã€‚éœ€è¦æˆ‘å¸®ä½ åˆ¶å®šå­¦ä¹ è®¡åˆ’å—ï¼Ÿ`, hasMemory: false };
                }
            }

            // é»˜è®¤å›å¤
            if (memoryBank.length > 0) {
                return { 
                    reply: `æˆ‘ç†è§£äº†ã€‚ç›®å‰æˆ‘è®°ä½äº†${memoryBank.length}æ¡å…³äºä½ çš„ä¿¡æ¯ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ`, 
                    hasMemory: false 
                };
            }

            return { 
                reply: 'ä½ å¥½ï¼æˆ‘æ˜¯Memory AIã€‚ä½ å¯ä»¥å‘Šè¯‰æˆ‘ä¸€äº›å…³äºä½ çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä½ çš„åå­—ã€èŒä¸šã€çˆ±å¥½ç­‰ï¼Œæˆ‘ä¼šè®°ä½å®ƒä»¬ã€‚', 
                hasMemory: false 
            };
        }

        // å‘é€æ¶ˆæ¯
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            addMessage('user', message);
            userInput.value = '';
            sendButton.disabled = true;
            showTyping();

            // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
            await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 1200));

            try {
                let reply, hasMemory;

                if (CONFIG.USE_DEMO_MODE || !CONFIG.API_ENDPOINT) {
                    // æ¼”ç¤ºæ¨¡å¼
                    const response = getDemoResponse(message);
                    reply = response.reply;
                    hasMemory = response.hasMemory;
                } else {
                    // çœŸå®APIè°ƒç”¨
                    const response = await fetch(CONFIG.API_ENDPOINT, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${CONFIG.API_KEY}`,
                        },
                        body: JSON.stringify({
                            input: message,
                        })
                    });

                    const data = await response.json();
                    reply = data.output || data.response || data.result || 'æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å›å¤ã€‚';
                    hasMemory = false; // æ ¹æ®å®é™…APIè¿”å›åˆ¤æ–­
                }

                hideTyping();
                addMessage('assistant', reply, hasMemory);

            } catch (error) {
                hideTyping();
                addMessage('assistant', 'âŒ è¿æ¥å¤±è´¥ã€‚å½“å‰è¿è¡Œåœ¨æ¼”ç¤ºæ¨¡å¼ä¸‹ã€‚');
                console.error('Error:', error);
            }

            sendButton.disabled = false;
            userInput.focus();
        }

        // å‘é€ç¤ºä¾‹
        function sendExample(text) {
            userInput.value = text;
            sendMessage();
        }

        // é”®ç›˜äº‹ä»¶
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            userInput.focus();
            
            // å¦‚æœé…ç½®äº†APIï¼Œéšè—æç¤º
            if (CONFIG.API_ENDPOINT && CONFIG.API_KEY) {
                const notice = document.getElementById('apiNotice');
                if (notice) notice.style.display = 'none';
            }
        };
    </script>
</body>
</html>